<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub File Explorer</title>
    <style>
        /* --- CSS for File Explorer Look --- */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #ECECEC; /* Light gray background, like old explorer */
        }
        .explorer-window {
            width: 80%;
            max-width: 1000px;
            margin: 50px auto;
            border: 1px solid #AAA;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
            background-color: #FFF;
        }
        .address-bar {
            padding: 8px 10px;
            background-color: #EEE;
            border-bottom: 1px solid #CCC;
            display: flex;
            align-items: center;
        }
        .address-bar label {
            font-weight: bold;
            color: #555;
            margin-right: 10px;
        }
        .address-bar input {
            flex-grow: 1;
            padding: 4px;
            border: 1px solid #888;
            border-radius: 3px;
            font-size: 14px;
            font-family: monospace; /* Mimic the file path look */
            background-color: #FFF;
        }
        .address-bar button {
            margin-left: 10px;
            padding: 5px 10px;
            border: 1px solid #888;
            background-color: #DDD;
            cursor: pointer;
            border-radius: 3px;
        }
        .file-list {
            min-height: 400px;
            padding: 10px;
            border-right: 1px solid #CCC; /* Subtle separator */
            overflow-y: auto;
        }
        .file-item {
            display: flex;
            align-items: center;
            padding: 4px 8px;
            cursor: pointer;
            border-radius: 2px;
            transition: background-color 0.1s;
        }
        .file-item:hover {
            background-color: #E0F0FF; /* Selection highlight */
        }
        .file-item:active {
            background-color: #C0DFFF;
        }
        .file-item .icon {
            margin-right: 8px;
            font-size: 18px; /* Use icons for that system look */
            line-height: 1;
        }
        .file-item .name {
            flex-grow: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .file-item.directory .name {
            font-weight: bold; /* Directories often look bolder */
            color: #0066CC;
        }
        .file-item.file .name {
            color: #333;
        }
        .error, .loading {
            padding: 20px;
            text-align: center;
            color: #CC0000;
        }
        .loading {
            color: #008CBA;
        }
        .path-segment {
            color: #0000FF;
            text-decoration: underline;
            cursor: pointer;
            margin: 0 2px;
        }
        .path-segment:hover {
            opacity: 0.8;
        }

        /* Icons: Using simple characters/emojis for a quick look */
        .icon.folder:before { content: 'üìÅ'; }
        .icon.text:before { content: 'üìÑ'; }
        .icon.code:before { content: 'üíæ'; }
        .icon.image:before { content: 'üñºÔ∏è'; }
        .icon.up:before { content: '‚¨ÜÔ∏è'; }

    </style>
</head>
<body>

    <div class="explorer-window">
        <div class="address-bar">
            <label>Path:</label>
            <input type="text" id="pathDisplay" value="" readonly>
            <button onclick="navigateUp()">Go Up</button>
        </div>

        <div id="fileList" class="file-list">
            <div class="loading">Enter a repository name above (e.g., **google/gemini-api-cookbook**) and click **Go Up** or press Enter.</div>
            </div>
    </div>

    <input type="hidden" id="repoInput" value="google/gemini-api-cookbook">

    <script>
        // --- JavaScript for GitHub API Interaction ---

        const BASE_URL = 'https://api.github.com/repos/';
        const repoInput = document.getElementById('repoInput');
        const pathDisplay = document.getElementById('pathDisplay');
        const fileListContainer = document.getElementById('fileList');

        // Initial state
        let currentRepo = repoInput.value;
        let currentPath = ''; // Root of the repository

        // Helper to get the correct icon class
        function getIconClass(name, type) {
            if (type === 'dir') return 'folder';
            const parts = name.toLowerCase().split('.');
            if (parts.length > 1) {
                const ext = parts.pop();
                if (['png', 'jpg', 'jpeg', 'gif', 'svg'].includes(ext)) return 'image';
                if (['js', 'html', 'css', 'py', 'java', 'c', 'cpp', 'sh', 'json', 'yml'].includes(ext)) return 'code';
            }
            return 'text'; // Default icon for files
        }

        // Function to render the file list
        function renderFileList(contents) {
            fileListContainer.innerHTML = ''; // Clear previous content

            // Sort directories first, then files alphabetically
            contents.sort((a, b) => {
                if (a.type === 'dir' && b.type !== 'dir') return -1;
                if (a.type !== 'dir' && b.type === 'dir') return 1;
                return a.name.localeCompare(b.name);
            });

            contents.forEach(item => {
                const type = item.type === 'dir' ? 'directory' : 'file';
                const iconClass = getIconClass(item.name, item.type);

                const itemDiv = document.createElement('div');
                itemDiv.className = `file-item ${type}`;
                itemDiv.innerHTML = `
                    <span class="icon ${iconClass}"></span>
                    <span class="name">${item.name}</span>
                `;

                if (type === 'directory') {
                    itemDiv.onclick = () => navigateTo(item.path);
                } else {
                    // Open the raw GitHub URL for file viewing
                    itemDiv.onclick = () => window.open(item.html_url, '_blank');
                }

                fileListContainer.appendChild(itemDiv);
            });

            if (contents.length === 0) {
                fileListContainer.innerHTML = '<div style="padding: 20px; color: #555;">(Folder is empty)</div>';
            }
        }

        // Function to update the displayed path and fetch data
        async function fetchGitHubContents(repo, path) {
            currentRepo = repo;
            currentPath = path;

            // 1. Update the address bar display
            updatePathDisplay();

            fileListContainer.innerHTML = '<div class="loading">Loading contents...</div>';

            const url = `${BASE_URL}${repo}/contents/${path}`;

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                const contents = await response.json();

                // If contents is an array, it's a directory listing
                if (Array.isArray(contents)) {
                    renderFileList(contents);
                } else if (contents.type === 'file') {
                    // If the path pointed directly to a file (shouldn't happen with the navigation flow, but good practice)
                    window.open(contents.html_url, '_blank');
                    // Go back to the parent folder
                    navigateUp(true);
                } else {
                    fileListContainer.innerHTML = '<div class="error">Not a valid directory or file.</div>';
                }

            } catch (error) {
                console.error('Error fetching GitHub contents:', error);
                fileListContainer.innerHTML = `<div class="error">Error: Could not load repository or path.<br>Details: ${error.message}</div>`;
            }
        }

        // Navigate to a new subpath
        function navigateTo(newPath) {
            fetchGitHubContents(currentRepo, newPath);
        }

        // Navigate to the parent directory
        function navigateUp(isRedirect = false) {
            // Get the current path segments
            const segments = currentPath.split('/').filter(s => s.length > 0);

            if (segments.length > 0) {
                // Remove the last segment
                segments.pop();
                const parentPath = segments.join('/');
                fetchGitHubContents(currentRepo, parentPath);
            } else if (!isRedirect) {
                // If at root, re-fetch the root content
                fetchGitHubContents(currentRepo, '');
            }
        }

        // Function to update the path display in the address bar
        function updatePathDisplay() {
            // Mimic the file:/// style path: file:///C:/GitHub/owner/repo/path/to/folder
            let displayPath = `file:///C:/GitHub/${currentRepo}`;

            // Add path segments
            const segments = currentPath.split('/').filter(s => s.length > 0);

            // Create clickable segments for the input field
            let pathHtml = `file:///C:/<span class="path-segment" onclick="navigateTo('')">GitHub/${currentRepo}</span>`;

            segments.forEach((segment, index) => {
                // Build the path up to this segment
                const segmentPath = segments.slice(0, index + 1).join('/');
                pathHtml += `/<span class="path-segment" onclick="navigateTo('${segmentPath}')">${segment}</span>`;
            });

            pathDisplay.value = `file:///C:/GitHub/${currentRepo}/${currentPath}`;
        }

        // --- Event Listener for Initial Load and Input ---

        // A simple way to trigger the initial load or a new repo
        const addressBarInput = document.querySelector('.address-bar input');

        document.addEventListener('DOMContentLoaded', () => {
            // Initial load using the default repo from the hidden input
            fetchGitHubContents(currentRepo, currentPath);

            // Allow the "Go Up" button to be used as a "Go" button for initial repo entry
            const goUpButton = document.querySelector('.address-bar button');
            goUpButton.onclick = () => {
                // Use the pathDisplay's value as the new input for simplicity
                const fullPath = pathDisplay.value;
                const match = fullPath.match(/file:\/\/\/C:\/GitHub\/([^/]+\/[^/]+)\/?(.*)/);
                if (match) {
                    const newRepo = match[1];
                    const newPath = match[2];
                    if (newRepo !== currentRepo || newPath !== currentPath) {
                        fetchGitHubContents(newRepo, newPath);
                    }
                } else {
                     // Fallback/Error: Re-load the root
                    fetchGitHubContents(currentRepo, '');
                }
            };
            
            // Allow ENTER key to act as 'Go Up' / 'Go'
            addressBarInput.addEventListener('keydown', (event) => {
                if (event.key === 'Enter') {
                    event.preventDefault(); // Stop form submission if it were a form
                    goUpButton.click();
                }
            });

            // Make the path display editable for easy initial input
            pathDisplay.removeAttribute('readonly');
            pathDisplay.value = `file:///C:/GitHub/${repoInput.value}`;
        });

    </script>

</body>
</html>
